{
	"projects": {
		"default": {
			"compiler": "clang",
			"c_standard": "c11",
			"cpp_standard": "c++17",

			"cpp_precompiled_header": "src/core.h",

			"c_compiler_flags": [],
			"emit_compile_commands": true,

			"run_args": [
				"-Wall",
				"--debug-ir-output",
				"--profile",
				"--stdlib-dir", "./bozon-stdlib",
				"-o", "./bitcode_test.o",
				"./src/bitcode_test.bz"
			],

			"source_directory": "src",
			"include_paths": [ "src", "include" ],

			"defines": [],
			"warnings": [
				"all",
				"extra",
				"no-c++20-extensions",
				"no-defaulted-function-deleted"
			],

			"prebuild_rules": [ "generate_opts" ],

			"configs": {
				"windows-debug": {},
				"windows-release": {},
				"linux-debug": {
					"optimization": "1",
					"cpp_compiler_flags": [ "-fno-omit-frame-pointer", "-fsanitize=address,undefined" ],
					"link_flags": [ "-fsanitize=address,undefined" ]
				},
				"linux-release": {},
				"windows": {
					"prelink_rules": [ "ryu_format.o" ],
					"link_flags": [ "-fuse-ld=lld", "ryu_format.o" ],
					"libraries": [ "LLVM", "dwarfstack" ]
				},
				"linux": {
					"prelink_rules": [ "ryu_format.linux.o" ],
					"compiler": "clang-13",
					"libraries": [ "LLVM-13", "backtrace" ],
					"link_flags": [ "-fuse-ld=lld-13", "ryu_format.linux.o" ],
					"warnings": [ "no-unused-parameter" ],
					"emit_compile_commands": false
				},
				"debug": {
					"cpp_compiler_flags": [ "-ferror-limit=2" ],
					"defines": [ "BOZON_NO_ARENA" ],
					"optimization": "0"
				},
				"release": {
					"cpp_compiler_flags": [ "-march=native", "-mtune=native", "-ferror-limit=2" ],
					"defines": [ "NDEBUG" ],
					"optimization": "3",
					"link_flags": [ "-flto" ],
					"cpp_compiler_flags": [ "-flto" ]
				}
			}
		},
		"test": {
			"depends_on": "default",
			"source_directory": "test",
			"defines": [],
			"run_args": [ "-Wall", "--debug-comptime-ir-output", "--no-error-highlight", "--stdlib-dir", "bozon-stdlib" ]
		},
		"gcc": {
			"compiler": "gcc",
			"depends_on": "default",
			"cpp_precompiled_header": "",

			"c_compiler_flags": [],
			"emit_compile_commands": false,

			"warnings": [
				"all",
				"extra"
			],

			"configs": {
				"windows-debug": {},
				"windows-release": {},
				"linux-debug": {
					"optimization": "1",
					"cpp_compiler_flags": [ "-fno-omit-frame-pointer", "-fsanitize=address,undefined" ],
					"link_flags": [ "-fsanitize=address,undefined" ]
				},
				"linux-release": {},
				"windows": {
					"link_flags": [ "-fuse-ld=lld", "ryu_format.o" ],
					"libraries": [ "LLVM", "dwarfstack" ]
				},
				"linux": {
					"compiler": "gcc-10",
					"libraries": [ "LLVM-13", "backtrace" ],
					"link_flags": [ "-fuse-ld=lld", "ryu_format.linux.o" ],
					"warnings": [ "no-unused-parameter" ]
				},
				"debug": {
					"cpp_compiler_flags": [],
					"defines": [ "BOZON_NO_ARENA" ],
					"optimization": "0"
				},
				"release": {
					"cpp_compiler_flags": [ "-march=native", "-mtune=native" ],
					"defines": [ "NDEBUG" ],
					"optimization": "3"
				}
			}
		},
		"test-gcc": {
			"depends_on": "gcc",
			"source_directory": "test",
			"defines": [],
			"run_args": [ "-Wall", "--debug-comptime-ir-output", "--no-error-highlight", "--stdlib-dir", "bozon-stdlib" ],
			"configs": {
				"linux": {
					"cpp_compiler_flags": [ "-fno-var-tracking-assignments" ]
				}
			}
		}
	},
	"rules": {
		"ryu_format.o": {
			"dependencies": [ "ryu_format.ll" ],
			"command": "llc ryu_format.ll --filetype=obj -o ryu_format.o"
		},
		"ryu_format.linux.o": {
			"dependencies": [ "ryu_format.linux.ll" ],
			"command": "llc-13 ryu_format.linux.ll --filetype=obj --relocation-model=pic -o ryu_format.linux.o"
		},
		"ryu_format.ll": {
			"dependencies": [ "ryu_format.bz" ],
			"command": "bin/windows-debug/bozon.exe --stdlib-dir bozon-stdlib -Wall -O3 -Omax-iter-count=8 ryu_format.bz -o ryu_format.ll --emit=llvm-ir --no-panic-on-unreachable"
		},
		"ryu_format.linux.ll": {
			"dependencies": [ "ryu_format.bz" ],
			"command": "bin/linux-debug/bozon --stdlib-dir bozon-stdlib -Wall -O3 -Omax-iter-count=8 ryu_format.bz -o ryu_format.linux.ll --emit=llvm-ir --no-panic-on-unreachable"
		},
		"ryu_format.gcc.ll": {
			"dependencies": [ "ryu_format.bz" ],
			"command": "bin/windows-debug/gcc-bozon.exe --stdlib-dir bozon-stdlib -Wall -O3 -Omax-iter-count=8 ryu_format.bz -o ryu_format.gcc.ll --emit=llvm-ir --no-panic-on-unreachable"
		},
		"ryu_format.linux.gcc.ll": {
			"dependencies": [ "ryu_format.bz" ],
			"command": "bin/linux-debug/gcc-bozon --stdlib-dir bozon-stdlib -Wall -O3 -Omax-iter-count=8 ryu_format.bz -o ryu_format.linux.gcc.ll --emit=llvm-ir --no-panic-on-unreachable"
		},
		"a.exe": {
			"dependencies": [ "bitcode_test.o", "builtins.o" ],
			"command": "clang bitcode_test.o builtins.o -o a.exe -fuse-ld=lld"
		},
		"a.out": {
			"dependencies": [ "bitcode_test.o", "builtins.linux.o" ],
			"command": "clang-13 bitcode_test.o builtins.linux.o -lm -o a.out -fuse-ld=lld-13"
		},
		"builtins.o": {
			"dependencies": [ "builtins.c" ],
			"command": "clang -c builtins.c -O3 -o builtins.o"
		},
		"builtins.linux.o": {
			"dependencies": [ "builtins.c" ],
			"command": "clang-13 -c builtins.c -O3 -o builtins.linux.o"
		},
		"generate_opts": {
			"command": "python3 scripts/gen_opts.py",
			"is_file": false
		},
		"fuzz-test/lex/fuzz.o": {
			"dependencies": [ "fuzz-test/lex/fuzz.cpp" ],
			"command": "clang++-13 -c -g `llvm-config-13 --cxxflags` -std=c++17 -fno-omit-frame-pointer -fsanitize=fuzzer,address -Isrc -Iinclude -DBOZON_NO_ARENA -Wall -Wextra -Wno-unused-parameter -Wno-c++20-extensions -Wno-defaulted-function-deleted -O1 -o fuzz-test/lex/fuzz.o fuzz-test/lex/fuzz.cpp"
		},
		"fuzz-test/lex/fuzz.out": {
			"dependencies": [ "fuzz-test/lex/fuzz.o" ],
			"command": "clang++-13 -o fuzz-test/lex/fuzz.out fuzz-test/lex/fuzz.o `llvm-config-13 --ldflags --libs --system-libs` -fsanitize=fuzzer,address -fuse-ld=lld -Wl,--unresolved-symbols=ignore-in-object-files"
		},
		"run-lex-fuzzer": {
			"dependencies": [ "fuzz-test/lex/fuzz.out" ],
			"command": "fuzz-test/lex/fuzz.out fuzz-test/lex/fuzz-corpus",
			"is_file": false
		}
	}
}
