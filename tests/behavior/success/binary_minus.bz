function minus_test(consteval a, consteval b)
{
	let dyn_a = a;
	let dyn_b = b;
	consteval result = ((a - b));
	if (dyn_a - dyn_b != result) unreachable;

	mut dyn_a = a;
	let dyn_b = b;
	dyn_a -= dyn_b;
	if (dyn_a != result) unreachable;
}

function minus_signed_overflow(intN: typename)
{
	consteval size_in_bits = 8 * sizeof intN;
	consteval max = ((1u64 << (size_in_bits - 1)) - 1) as intN;
	consteval min = (((1u64 << (size_in_bits - 1)) as intN));

	minus_test(max, -1 as intN);
	minus_test(-1 as intN, max);

	minus_test(min, 1 as intN);
	minus_test(1 as intN, min);

	minus_test(max, min);
	minus_test(min, max);
}

function minus_unsigned_overflow(uintN: typename)
{
	consteval max = ~uintN(0);

	minus_test(0 as uintN, 1 as uintN);
	minus_test(max / 3, max);
}

function main()
{
	minus_test(10u8, 3u8);
	minus_test(10u16, 3u16);
	minus_test(10u32, 3u32);
	minus_test(10u64, 3u64);
	minus_test(3i8, 10i8);
	minus_test(3i16, 10i16);
	minus_test(3i32, 10i32);
	minus_test(3i64, 10i64);
	minus_test(10i8, 3i8);
	minus_test(10i16, 3i16);
	minus_test(10i32, 3i32);
	minus_test(10i64, 3i64);
	minus_test(-3i8, 10i8);
	minus_test(-3i16, 10i16);
	minus_test(-3i32, 10i32);
	minus_test(-3i64, 10i64);
	minus_test(0.1f32, 0.2f32);
	minus_test(0.1f64, 0.2f64);

	consteval inf_f32 = ((1.0f32 / 0.0f32));
	consteval inf_f64 = ((1.0f64 / 0.0f64));
	minus_test(inf_f32, -3.235f32);
	minus_test(inf_f64, -3.235f64);
	minus_test(-3.235f32, inf_f32);
	minus_test(-3.235f64, inf_f64);
	minus_test(inf_f32, -inf_f32);
	minus_test(inf_f64, -inf_f64);
	minus_test(-inf_f32, inf_f32);
	minus_test(-inf_f64, inf_f64);

	minus_signed_overflow(int8);
	minus_signed_overflow(int16);
	minus_signed_overflow(int32);
	minus_signed_overflow(int64);

	minus_unsigned_overflow(uint8);
	minus_unsigned_overflow(uint16);
	minus_unsigned_overflow(uint32);
	minus_unsigned_overflow(uint64);

	let a = [10: int32]();
	let p1 = &a[0];
	let p2 = &a[8];
	if (p1 != p2 - 8) unreachable;

	mut p = &a[5];
	p -= 5;
	if (p != &a[0]) unreachable;

	let a = [10: [int32, str, [3: float32]]]();
	let p1 = &a[0];
	let p2 = &a[8];
	if (p1 != p2 - 8) unreachable;

	mut p = &a[5];
	p -= 5;
	if (p != &a[0]) unreachable;

	let p1 = &a[2];
	let p2 = &a[8];
	if (p1 - p2 != -6) unreachable;
	if (p2 - p1 != 6) unreachable;
}
