import resource;
import counting_resource;

function foo() {}

function main()
{
	{
		let o = (?int32)();
		let o = move o;
		if (o != null) unreachable;
		let o = (?*int32)();
		let o = move o;
		if (o != null) unreachable;
		let o = (?*mut int32)();
		let o = move o;
		if (o != null) unreachable;
		let o = (?**int32)();
		let o = move o;
		if (o != null) unreachable;
		// TODO:
		// let o = (?&int32)();
		// let o = move o;
		// if (o != null) unreachable;
		let o = (?function() -> void)();
		let o = move o;
		if (o != null) unreachable;
	}

	{
		let o: ?int32 = 42;
		let o = move o;
		if (o == null) unreachable;
		if (o.get_value() != 42) unreachable;
		mut i = 0;
		let o: ?*int32 = &i;
		let o = o;
		if (o == null) unreachable;
		if (o.get_value() != &i) unreachable;
		let o: ?*mut int32 = &i;
		let o = move o;
		if (o == null) unreachable;
		if (o.get_value() != &i) unreachable;
		let p = &i;
		let o: ?**int32 = &p;
		let o = move o;
		if (o == null) unreachable;
		if (o.get_value() != &p) unreachable;
		let o: ?&int32 = i;
		let o = move o;
		// TODO:
		// if (o == null) unreachable;
		if (&o.get_value() != &i) unreachable;
		let o: ?function() -> void = foo;
		let o = move o;
		if (o == null) unreachable;
		if (o.get_value() != foo) unreachable;
	}

	{
		let o = (?resource_t)();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[10: resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?complex_resource_t)();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[complex_resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[10: complex_resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?relocatable_counting_resource_t)();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[relocatable_counting_resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[10: relocatable_counting_resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?counting_resource_t)();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[counting_resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[10: counting_resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[resource_t, complex_resource_t, relocatable_counting_resource_t, counting_resource_t])();
		let o = move o;
		if (o != null) unreachable;
		let o = (?[10: [resource_t, complex_resource_t, relocatable_counting_resource_t, counting_resource_t]])();
		let o = move o;
		if (o != null) unreachable;
	}

	{
		let o: ?resource_t = resource_t();
		let o = move o;
		if (o == null) unreachable;
		let t = [resource_t()];
		let o: ?[resource_t] = move t;
		let o = move o;
		if (o == null) unreachable;
		let a: [10: auto] = [
			resource_t(),
			resource_t(),
			resource_t(),
			resource_t(),
			resource_t(),
			resource_t(),
			resource_t(),
			resource_t(),
			resource_t(),
			resource_t(),
		];
		let o: ?[10: resource_t] = move a;
		let o = move o;
		if (o == null) unreachable;
		let o: ?complex_resource_t = complex_resource_t();
		let o = move o;
		if (o == null) unreachable;
		let t = [complex_resource_t()];
		let o: ?[complex_resource_t] = move t;
		let o = move o;
		if (o == null) unreachable;
		let a: [20: auto] = [
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
			complex_resource_t(),
		];
		let o: ?[20: complex_resource_t] = move a;
		let o = move o;
		if (o == null) unreachable;
		let o: ?relocatable_counting_resource_t = relocatable_counting_resource_t();
		let o = move o;
		if (o == null) unreachable;
		let t = [relocatable_counting_resource_t()];
		let o: ?[relocatable_counting_resource_t] = move t;
		let o = move o;
		if (o == null) unreachable;
		let a: [10: auto] = [
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
			relocatable_counting_resource_t(),
		];
		let o: ?[10: relocatable_counting_resource_t] = move a;
		let o = move o;
		if (o == null) unreachable;
		let o: ?counting_resource_t = counting_resource_t();
		let o = move o;
		if (o == null) unreachable;
		let t = [counting_resource_t()];
		let o: ?[counting_resource_t] = move t;
		let o = move o;
		if (o == null) unreachable;
		let a: [10: auto] = [
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
			counting_resource_t(),
		];
		let o: ?[10: counting_resource_t] = move a;
		let o = move o;
		if (o == null) unreachable;
		let t = [ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ];
		let o: ?[resource_t, complex_resource_t, relocatable_counting_resource_t, counting_resource_t] = move t;
		let o = move o;
		if (o == null) unreachable;
		let a: [10: auto] = [
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
			[ resource_t(), complex_resource_t(), relocatable_counting_resource_t(), counting_resource_t() ],
		];
		let o: ?[10: [resource_t, complex_resource_t, relocatable_counting_resource_t, counting_resource_t]] = move a;
		let o = move o;
		if (o == null) unreachable;
	}

	if (!counting_resource_is_valid()) unreachable;
	if (!relocatable_counting_resource_is_valid()) unreachable;
}
