import resource;
import counting_resource;

function test_null_assign(T: typename)
{
	let mut a: ?T = null;
	a = null;
	if (a != null) unreachable;

	let mut a: ?T = T();
	a = null;
	if (a != null) unreachable;

	let a = T();
	let mut p: ?*T = null;
	p = null;
	if (p != null) unreachable;

	let mut p: ?*T = &a;
	p = null;
	if (p != null) unreachable;
}

function main()
{
	test_null_assign(i32);
	test_null_assign(resource_t);
	test_null_assign(complex_resource_t);
	test_null_assign(counting_resource_t);
	test_null_assign(relocatable_counting_resource_t);

	if (!counting_resource_is_valid()) unreachable;
	if (!relocatable_counting_resource_is_valid()) unreachable;
}
