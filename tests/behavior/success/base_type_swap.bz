import resource;
import counting_resource;

struct S
{
	.r: counting_resource_t;
	.i: i32;
	.x: f64;
	.s: str;
}

function main()
{
	{
		let mut a = resource_t();
		__builtin_swap(a, a);
		let mut a = complex_resource_t();
		__builtin_swap(a, a);
		let mut a = counting_resource_t();
		__builtin_swap(a, a);
		let mut a = relocatable_counting_resource_t();
		__builtin_swap(a, a);
		let mut a = S[ counting_resource_t(), 42, 3.14, "hello" ];
		__builtin_swap(a, a);
		if (a.i != 42) unreachable;
		if (a.x != 3.14) unreachable;
		if (a.s != "hello") unreachable;
	}

	{
		let mut a = resource_t();
		let mut b = resource_t();
		__builtin_swap(a, b);
		let mut a = complex_resource_t();
		let mut b = complex_resource_t();
		__builtin_swap(a, b);
		let mut a = counting_resource_t();
		let mut b = counting_resource_t();
		__builtin_swap(a, b);
		let mut a = relocatable_counting_resource_t();
		let mut b = relocatable_counting_resource_t();
		__builtin_swap(a, b);
		let mut a = S[ counting_resource_t(), 42, 3.14, "hello" ];
		let mut b = S[ counting_resource_t(), -99, 2.71, "there" ];
		__builtin_swap(a, b);
		if (a.i != -99) unreachable;
		if (a.x != 2.71) unreachable;
		if (a.s != "there") unreachable;
		if (b.i != 42) unreachable;
		if (b.x != 3.14) unreachable;
		if (b.s != "hello") unreachable;
	}

	if (!counting_resource_is_valid()) unreachable;
	if (!relocatable_counting_resource_is_valid()) unreachable;
}
